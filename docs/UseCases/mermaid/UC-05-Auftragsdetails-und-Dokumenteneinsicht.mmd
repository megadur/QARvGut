sequenceDiagram
    participant GUT as Gutachter
    participant RVG as rvGutachten System
    participant DB as Datenbank
    participant PUR as rvPuR/rvArchiv
    participant PDF as PDF-Viewer
    participant AUD as Audit Manager

    Note over GUT,AM: UC05 Auftragsdetails einsehen und Dokumente verwalten

    GUT->>RVG: 01. Auf Auftrag in Übersicht klicken
    RVG->>DB: 02. Auftragsberechtigung prüfen
    DB->>RVG: 03. Berechtigung bestätigt

    alt Berechtigung entzogen
        RVG->>GUT: 4a. Weiterleitung zur Übersicht + Hinweis
    else Berechtigung OK
        RVG->>DB: 4b. Erweiterte Auftragsinformationen laden
        DB->>RVG: 05. VSNR, Proband, Geburtsdatum, Status, etc.

        par Auftragsdaten anzeigen
            RVG->>GUT: 6a. Detailansicht mit erweiterten Informationen

        and Dokumente laden
            RVG->>DB: 6b. Zugeordnete Dokumente abfragen
            DB->>RVG: 07. Dokumentenliste + Metadaten
            RVG->>GUT: 08. Dokumentenübersicht anzeigen
        end
    end

    Note over GUT,AM: Dokumentenmanagement

    GUT->>RVG: 09. Dokument zum Öffnen auswählen

    alt Stornierter Auftrag
        RVG->>GUT: 10a. Eingeschränkte Funktionalität - nur Einsicht
    else Aktiver Auftrag
        RVG->>DB: 10b. Dokumentenzugriff protokollieren
        DB->>AUD: 11. Audit-Log erstellen

        RVG->>PUR: 12. Dokument anfordern
        alt Dokument nicht verfügbar
            PUR->>RVG: 13a. Fehler - Dokument nicht gefunden
            RVG->>GUT: 14a. Fehlermeldung + Kontaktmöglichkeit
        else Dokument verfügbar
            PUR->>RVG: 13b. Dokument-Stream + Metadaten

            alt PDF-Direktanzeige
                RVG->>PDF: 14b. PDF-Viewer initialisieren
                PDF->>GUT: 15a. Dokument in Viewer anzeigen
                Note over GUT,PDF: Zoom, Pan, Navigation verfügbar

            else Download-Funktion
                GUT->>RVG: 15b. Download-Button klicken
                RVG->>RVG: 16a. Watermark hinzufügen (falls erforderlich)
                RVG->>GUT: 17a. Sicherer Download starten
                RVG->>AUD: 18a. Download protokollieren

            else Druck-Funktion
                GUT->>RVG: 15c. Drucken-Button klicken
                RVG->>RVG: 16b. Druckbare Version erstellen
                RVG->>GUT: 17b. Druckdialog öffnen (Formaterhaltung)
                RVG->>AUD: 18b. Druckvorgang protokollieren
            end
        end
    end

    Note over GUT,AM: Notizenfunktion

    GUT->>RVG: 19. Notiz zu Dokument erstellen/bearbeiten
    RVG->>DB: 20. Notiz speichern (dokumentenbezogen)
    DB->>RVG: 21. Speicherung bestätigt
    RVG->>GUT: 22. Notiz in Dokument-Kontext anzeigen
    RVG->>AUD: 23. Notizen-Aktivität protokollieren

    Note over GUT,AM: Navigation und Sicherheit

    alt Zurück zur Übersicht
        GUT->>RVG: 24. Zurück-Button/Navigation
        RVG->>GUT: 25. Rückkehr zur Auftragsübersicht
    end

    Note over RG,AM: Kontinuierliche Sicherheitsüberwachung
    RVG->>AUD: 26. Alle Dokumentenzugriffe auditieren
    RVG->>RVG: 27. Schutz vor unbefugtem Zugriff
    RVG->>RVG: 28. Session-Timeout überwachen
